!function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}({18:function(e,t){let r=[];const o=()=>{$("#username").val(""),$("#password").val(""),$("#confirm_password").val(""),$("#role").val(""),$("#force_password_change_checkbox").prop("checked",!0),$("#account_locked_checkbox").prop("checked",!1),$("#modal\\.flashes").empty()},s=e=>{$("#username").attr("disabled",!1),$("#modalSubmit").unbind("click").click(()=>{(e=>{if($("#password").val()!==$("#confirm_password").val())return void modalError("Passwords must match.");let t={username:$("#username").val(),password:$("#password").val(),role:$("#role").val(),password_change_required:$("#force_password_change_checkbox").prop("checked"),account_locked:$("#account_locked_checkbox").prop("checked")};-1!=e?(t.id=e,api.userId.put(t).success(e=>{successFlash("User "+escapeHtml(t.username)+" updated successfully!"),a(),o(),$("#modal").modal("hide")}).error(e=>{modalError(e.responseJSON.message)})):api.users.post(t).success(e=>{successFlash("User "+escapeHtml(t.username)+" registered successfully!"),a(),o(),$("#modal").modal("hide")}).error(e=>{modalError(e.responseJSON.message)})})(e)}),$("#role").select2(),-1==e?($("#userModalLabel").text("New User"),$("#role").val("user"),$("#role").trigger("change")):($("#userModalLabel").text("Edit User"),api.userId.get(e).success(e=>{$("#username").val(e.username),$("#role").val(e.role.slug),$("#role").trigger("change"),$("#force_password_change_checkbox").prop("checked",e.password_change_required),$("#account_locked_checkbox").prop("checked",e.account_locked),"admin"==e.username&&$("#username").attr("disabled",!0)}).error(function(){errorFlash("Error fetching user")}))},a=()=>{$("#userTable").hide(),$("#loading").show(),api.users.get().success(e=>{r=e,$("#loading").hide(),$("#userTable").show();let t=$("#userTable").DataTable({destroy:!0,columnDefs:[{orderable:!1,targets:"no-sort"}]});t.clear(),userRows=[],$.each(r,(e,t)=>{lastlogin="Never","0001-01-01T00:00:00Z"!=t.last_login&&(lastlogin=moment(t.last_login).format("MMMM Do YYYY, h:mm:ss a")),userRows.push([escapeHtml(t.username),escapeHtml(t.role.name),lastlogin,"<div class='pull-right'>                    <button class='btn btn-warning impersonate_button' data-user-id='"+t.id+"'>                    <i class='fa fa-retweet'></i>                    </button>                    <button class='btn btn-primary edit_button' data-toggle='modal' data-backdrop='static' data-target='#modal' data-user-id='"+t.id+"'>                    <i class='fa fa-pencil'></i>                    </button>                    <button class='btn btn-danger delete_button' data-user-id='"+t.id+"'>                    <i class='fa fa-trash-o'></i>                    </button></div>"])}),t.rows.add(userRows).draw()}).error(()=>{errorFlash("Error fetching users")})};$(document).ready(function(){a(),$("#modal").on("hide.bs.modal",function(){o()}),$.fn.select2.defaults.set("width","100%"),$.fn.select2.defaults.set("dropdownParent",$("#role-select")),$.fn.select2.defaults.set("theme","bootstrap"),$.fn.select2.defaults.set("sorter",function(e){return e.sort(function(e,t){return e.text.toLowerCase()>t.text.toLowerCase()?1:e.text.toLowerCase()<t.text.toLowerCase()?-1:0})}),$("#new_button").on("click",function(){s(-1)}),$("#userTable").on("click",".edit_button",function(e){s($(this).attr("data-user-id"))}),$("#userTable").on("click",".delete_button",function(e){var t,o;t=$(this).attr("data-user-id"),(o=r.find(e=>e.id==t))&&("admin"!=o.username?Swal.fire({title:"Are you sure?",text:"This will delete the account for "+escapeHtml(o.username)+" as well as all of the objects they have created.\n\nThis can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise((e,r)=>{api.userId.delete(t).success(t=>{e()}).error(e=>{r(e.responseJSON.message)})}).catch(e=>{Swal.showValidationMessage(e)})}}).then(function(e){e.value&&Swal.fire("User Deleted!","The user account for "+escapeHtml(o.username)+" and all associated objects have been deleted!","success"),$('button:contains("OK")').on("click",function(){location.reload()})}):Swal.fire({title:"Unable to Delete User",text:"The user account "+escapeHtml(o.username)+" cannot be deleted.",type:"info"}))}),$("#userTable").on("click",".impersonate_button",function(e){var t,o;t=$(this).attr("data-user-id"),(o=r.find(e=>e.id==t))&&Swal.fire({title:"Are you sure?",html:"You will be logged out of your account and logged in as <strong>"+escapeHtml(o.username)+"</strong>",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Swap User",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1}).then(e=>{e.value&&fetch("/impersonate",{method:"post",body:"username="+o.username+"&csrf_token="+encodeURIComponent(csrf_token),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{200==e.status?Swal.fire({title:"Success!",html:"Successfully changed to user <strong>"+escapeHtml(o.username)+"</strong>.",type:"success",showCancelButton:!1,confirmButtonText:"Home",allowOutsideClick:!1}).then(e=>{e.value&&(window.location.href="/")}):Swal.fire({title:"Error!",type:"error",html:"Failed to change to user <strong>"+escapeHtml(o.username)+"</strong>.",showCancelButton:!1})})})})})}});