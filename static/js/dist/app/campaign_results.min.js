!function(e){var t={};function a(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(s,i,function(t){return e[t]}.bind(null,i));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}({4:function(e,t){var a=null,s=!0,i={"Email Sent":{color:"#1abc9c",label:"label-success",icon:"fa-envelope",point:"ct-point-sent"},"Emails Sent":{color:"#1abc9c",label:"label-success",icon:"fa-envelope",point:"ct-point-sent"},"In progress":{label:"label-primary"},Queued:{label:"label-info"},Completed:{label:"label-success"},"Email Opened":{color:"#f9bf3b",label:"label-warning",icon:"fa-envelope-open",point:"ct-point-opened"},"Clicked Link":{color:"#F39C12",label:"label-clicked",icon:"fa-mouse-pointer",point:"ct-point-clicked"},Success:{color:"#f05b4f",label:"label-danger",icon:"fa-exclamation",point:"ct-point-clicked"},"Email Reported":{color:"#45d6ef",label:"label-info",icon:"fa-bullhorn",point:"ct-point-reported"},Error:{color:"#6c7a89",label:"label-default",icon:"fa-times",point:"ct-point-error"},"Error Sending Email":{color:"#6c7a89",label:"label-default",icon:"fa-times",point:"ct-point-error"},"Submitted Data":{color:"#f05b4f",label:"label-danger",icon:"fa-exclamation",point:"ct-point-clicked"},Unknown:{color:"#6c7a89",label:"label-default",icon:"fa-question",point:"ct-point-error"},Sending:{color:"#428bca",label:"label-primary",icon:"fa-spinner",point:"ct-point-sending"},Retrying:{color:"#6c7a89",label:"label-default",icon:"fa-clock-o",point:"ct-point-error"},Scheduled:{color:"#428bca",label:"label-primary",icon:"fa-clock-o",point:"ct-point-sending"},"Campaign Created":{label:"label-success",icon:"fa-rocket"}},l={"Email Sent":"sent","Email Opened":"opened","Clicked Link":"clicked","Submitted Data":"submitted_data","Email Reported":"reported"},r=["Email Sent","Email Opened","Clicked Link","Submitted Data"],n={},o=[];var c=function(e){var t=UAParser(details.browser["user-agent"]),a='<div class="timeline-device-details">',s="laptop";t.device.type&&("tablet"!=t.device.type&&"mobile"!=t.device.type||(s=t.device.type));var i="";t.device.vendor&&"microsoft"==(i=t.device.vendor.toLowerCase())&&(i="windows");var l="Unknown";t.os.name&&("Mac OS"==(l=t.os.name)?i="apple":"Windows"==l&&(i="windows"),t.device.vendor&&t.device.model&&(l=t.device.vendor+" "+t.device.model)),t.os.version&&(l=l+" (OS Version: "+t.os.version+")"),deviceString='<div class="timeline-device-os"><span class="fa fa-stack"><i class="fa fa-'+escapeHtml(s)+' fa-stack-2x"></i><i class="fa fa-vendor-icon fa-'+escapeHtml(i)+' fa-stack-1x"></i></span> '+escapeHtml(l)+"</div>",a+=deviceString;var r="Unknown",n="info-circle",o="";return t.browser&&t.browser.name&&((r=(r=t.browser.name).replace("Mobile ",""))&&"ie"==(n=r.toLowerCase())&&(n="internet-explorer"),o="(Version: "+t.browser.version+")"),a+='<div class="timeline-device-browser"><span class="fa fa-stack"><i class="fa fa-'+escapeHtml(n)+' fa-stack-1x"></i></span> '+r+" "+o+"</div>",a+="</div>"};function d(e){return record={id:e[0],first_name:e[2],last_name:e[3],email:e[4],position:e[5],status:e[6],reported:e[7],send_date:e[8]},results='<div class="timeline col-sm-12 well well-lg"><h6>Timeline for '+escapeHtml(record.first_name)+" "+escapeHtml(record.last_name)+'</h6><span class="subtitle">Email: '+escapeHtml(record.email)+"<br>Result ID: "+escapeHtml(record.id)+'</span><div class="timeline-graph col-sm-6">',$.each(n.timeline,function(e,t){t.email&&t.email!=record.email||(results+='<div class="timeline-entry">    <div class="timeline-bar"></div>',results+='    <div class="timeline-icon '+i[t.message].label+'">    <i class="fa '+i[t.message].icon+'"></i></div>    <div class="timeline-message">'+escapeHtml(t.message)+'    <span class="timeline-date">'+moment.utc(t.time).local().format("MMMM Do YYYY h:mm:ss a")+"</span>",t.details&&(details=JSON.parse(t.details),"Clicked Link"!=t.message&&"Submitted Data"!=t.message||(deviceView=c(details),deviceView&&(results+=deviceView)),"Submitted Data"==t.message&&(results+='<div class="timeline-replay-button"><button onclick="replay('+e+')" class="btn btn-success">',results+='<i class="fa fa-refresh"></i> Replay Credentials</button></div>',results+='<div class="timeline-event-details"><i class="fa fa-caret-right"></i> View Details</div>'),details.payload&&(results+='<div class="timeline-event-results">',results+='    <table class="table table-condensed table-bordered table-striped">',results+="        <thead><tr><th>Parameter</th><th>Value(s)</tr></thead><tbody>",$.each(Object.keys(details.payload),function(e,t){if("rid"==t)return!0;results+="    <tr>",results+="        <td>"+escapeHtml(t)+"</td>",results+="        <td>"+escapeHtml(details.payload[t])+"</td>",results+="    </tr>"}),results+="       </tbody></table>",results+="</div>"),details.error&&(results+='<div class="timeline-event-details"><i class="fa fa-caret-right"></i> View Details</div>',results+='<div class="timeline-event-results">',results+='<span class="label label-default">Error</span> '+details.error,results+="</div>")),results+="</div></div>")}),"Scheduled"!=record.status&&"Retrying"!=record.status||(results+='<div class="timeline-entry">    <div class="timeline-bar"></div>',results+='    <div class="timeline-icon '+i[record.status].label+'">    <i class="fa '+i[record.status].icon+'"></i></div>    <div class="timeline-message">Scheduled to send at '+record.send_date+"</span>"),results+="</div></div>",results}var u,m=function(e){return Highcharts.chart("timeline_chart",{chart:{zoomType:"x",type:"line",height:"200px"},title:{text:"Campaign Timeline"},xAxis:{type:"datetime",dateTimeLabelFormats:{second:"%l:%M:%S",minute:"%l:%M",hour:"%l:%M",day:"%b %d, %Y",week:"%b %d, %Y",month:"%b %Y"}},yAxis:{min:0,max:2,visible:!1,tickInterval:1,labels:{enabled:!1},title:{text:""}},tooltip:{formatter:function(){return Highcharts.dateFormat("%A, %b %d %l:%M:%S %P",new Date(this.x))+"<br>Event: "+this.point.message+"<br>Email: <b>"+this.point.email+"</b>"}},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,symbol:"circle",radius:3},cursor:"pointer"},line:{states:{hover:{lineWidth:1}}}},credits:{enabled:!1},series:[{data:e.data,dashStyle:"shortdash",color:"#cccccc",lineWidth:1,turboThreshold:0}]})},p=function(e){return Highcharts.chart(e.elemId,{chart:{type:"pie",events:{load:function(){var t=this.renderer,a=this.series[0],s=this.plotLeft+a.center[0],i=this.plotTop+a.center[1];this.innerText=t.text(e.data[0].count,s,i).attr({"text-anchor":"middle","font-size":"24px","font-weight":"bold",fill:e.colors[0],"font-family":"Helvetica,Arial,sans-serif"}).add()},render:function(){this.innerText.attr({text:e.data[0].count})}}},title:{text:e.title},plotOptions:{pie:{innerSize:"80%",dataLabels:{enabled:!1}}},credits:{enabled:!1},tooltip:{formatter:function(){return null!=this.key&&'<span style="color:'+this.color+'">‚óè</span>'+this.point.name+": <b>"+this.y+"%</b><br/>"}},series:[{data:e.data,colors:e.colors}]})},f=function(e){a&&(o=[],$.each(n.results,function(e,t){if(0==t.latitude&&0==t.longitude)return!0;newIP=!0,$.each(o,function(e,a){if(a.ip==t.ip)return o[e].radius+=1,newIP=!1,!1}),newIP&&o.push({latitude:t.latitude,longitude:t.longitude,name:t.ip,fillKey:"point",radius:2})}),a.bubbles(o))};function b(){n.id=window.location.pathname.split("/").slice(-1)[0];var e=JSON.parse(localStorage.getItem("gophish.use_map"));api.campaignId.results(n.id).success(function(t){if(n=t){$("title").text(t.name+" - Gophish"),$("#loading").hide(),$("#campaignResults").show(),$("#page-title").text("Results for "+t.name),"Completed"==t.status&&($("#complete_button")[0].disabled=!0,$("#complete_button").text("Completed!"),s=!1),$("#resultsTable").on("click",".timeline-event-details",function(){payloadResults=$(this).parent().find(".timeline-event-results"),payloadResults.is(":visible")?($(this).find("i").removeClass("fa-caret-down"),$(this).find("i").addClass("fa-caret-right"),payloadResults.hide()):($(this).find("i").removeClass("fa-caret-right"),$(this).find("i").addClass("fa-caret-down"),payloadResults.show())}),resultsTable=$("#resultsTable").DataTable({destroy:!0,order:[[2,"asc"]],columnDefs:[{orderable:!1,targets:"no-sort"},{className:"details-control",targets:[1]},{visible:!1,targets:[0,8]},{render:function(e,t,a){return s=e,l=a[8],r=i[s].label||"label-default",n='<span class="label '+r+'">'+s+"</span>","Scheduled"!=s&&"Retrying"!=s||(n='<span class="label '+r+'" data-toggle="tooltip" data-placement="top" data-html="true" title="Scheduled to send at '+l+'">'+s+"</span>"),n;var s,l,r,n},targets:[6]},{className:"text-center",render:function(e,t,a){return"display"==t?e?"<i class='fa fa-check-circle text-center text-success'></i>":"<i role='button' class='fa fa-times-circle text-center text-muted' onclick='report_mail(\""+a[0]+'", "'+n.id+"\");'></i>":e},targets:[7]}]}),resultsTable.clear();var o={},c=[];Object.keys(l).forEach(function(e){o[e]=0}),$.each(n.results,function(e,t){resultsTable.row.add([t.id,'<i id="caret" class="fa fa-caret-right"></i>',escapeHtml(t.first_name)||"",escapeHtml(t.last_name)||"",escapeHtml(t.email)||"",escapeHtml(t.position)||"",t.status,t.reported,moment(t.send_date).format("MMMM Do YYYY, h:mm:ss a")]),o[t.status]++,t.reported&&o["Email Reported"]++;var a=r.indexOf(t.status);for(e=0;e<a;e++)o[r[e]]++}),resultsTable.draw(),$('[data-toggle="tooltip"]').tooltip(),$("#resultsTable tbody").on("click","td.details-control",function(){var e=$(this).closest("tr"),t=resultsTable.row(e);t.child.isShown()?(t.child.hide(),e.removeClass("shown"),$(this).find("i").removeClass("fa-caret-down"),$(this).find("i").addClass("fa-caret-right")):($(this).find("i").removeClass("fa-caret-right"),$(this).find("i").addClass("fa-caret-down"),t.child(d(t.data())).show(),e.addClass("shown"))}),$.each(n.timeline,function(e,t){if("Campaign Created"==t.message)return!0;var a=moment.utc(t.time).local();c.push({email:t.email,message:t.message,x:a.valueOf(),y:1,marker:{fillColor:i[t.message].color}})}),m({data:c}),$.each(o,function(e,t){var a=[];if(!(e in l))return!0;a.push({name:e,y:Math.floor(t/n.results.length*100),count:t}),a.push({name:"",y:100-Math.floor(t/n.results.length*100)});p({elemId:l[e]+"_chart",title:e,name:e,data:a,colors:[i[e].color,"#dddddd"]})}),e&&($("#resultsMapContainer").show(),a=new Datamap({element:document.getElementById("resultsMap"),responsive:!0,fills:{defaultFill:"#ffffff",point:"#283F50"},geographyConfig:{highlightFillColor:"#1abc9c",borderColor:"#283F50"},bubblesConfig:{borderColor:"#283F50"}})),f(n.results)}}).error(function(){$("#loading").hide(),errorFlash(" Campaign not found!")})}function h(){s&&($("#refresh_message").show(),$("#refresh_btn").hide(),api.campaignId.results(n.id).success(function(e){n=e;var t=[];$.each(n.timeline,function(e,a){var s=moment.utc(a.time).local();t.push({email:a.email,message:a.message,x:s.valueOf(),y:1,marker:{fillColor:i[a.message].color}})}),$("#timeline_chart").highcharts().series[0].update({data:t});var a={};Object.keys(l).forEach(function(e){a[e]=0}),$.each(n.results,function(e,t){a[t.status]++,t.reported&&a["Email Reported"]++;var s=r.indexOf(t.status);for(e=0;e<s;e++)a[r[e]]++}),$.each(a,function(e,t){var a=[];if(!(e in l))return!0;a.push({name:e,y:Math.floor(t/n.results.length*100),count:t}),a.push({name:"",y:100-Math.floor(t/n.results.length*100)}),$("#"+l[e]+"_chart").highcharts().series[0].update({data:a})}),resultsTable=$("#resultsTable").DataTable(),resultsTable.rows().every(function(e,t,a){var s=this.row(e),i=s.data(),l=i[0];$.each(n.results,function(t,a){if(a.id==l)return i[8]=moment(a.send_date).format("MMMM Do YYYY, h:mm:ss a"),i[7]=a.reported,i[6]=a.status,resultsTable.row(e).data(i),s.child.isShown()&&($(s.node()).find("#caret").removeClass("fa-caret-right"),$(s.node()).find("#caret").addClass("fa-caret-down"),s.child(d(s.data()))),!1})}),resultsTable.draw(!1),f(n.results),$('[data-toggle="tooltip"]').tooltip(),$("#refresh_message").hide(),$("#refresh_btn").show()}),clearTimeout(u),u=setTimeout(h,6e4))}$(document).ready(function(){Highcharts.setOptions({global:{useUTC:!1}}),b(),u=setTimeout(h,6e4)})}});