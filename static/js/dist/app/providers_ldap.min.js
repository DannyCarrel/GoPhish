var ldap_servers=[];function saveLdap(a){let e={};e.name=$("#ldap_name").val(),e.protocol=$("#ldap_protocol").val(),e.host=$("#ldap_host").val(),e.username=$("#ldap_username").val(),e.password=$("#ldap_password").val(),e.base_dn=$("#ldap_base_dn").val(),e.query=$("#ldap_query").val(),e.attributes=$("#ldap_attributes").val(),e.ignore_cert_errors=$("#ldap_ignore_cert_errors").prop("checked"),-1!=a?(e.id=ldap_servers[a].id,api.LDAPId.put(e).success((function(a){successFlash("Server edited successfully!"),loadLdaps(),dismissLdap()})).error((function(a){modalError(a.responseJSON.message)}))):api.LDAP.post(e).success((function(a){successFlash("Server added successfully!"),loadLdaps(),dismissLdap()})).error((function(a){modalError(a.responseJSON.message)}))}function dismissLdap(){$("#ldap_modal\\.flashes").empty(),$("#ldap_name").val(""),$("#ldap_protocol").val("ldap"),$("#ldap_host").val(""),$("#ldap_username").val(""),$("#ldap_password").val(""),$("#ldap_base_dn").val(""),$("#ldap_query").val(""),$("#ldap_attributes").val(""),$("#ldap_ignore_cert_errors").prop("checked",!0),$("#ldap_modal").modal("hide")}var deleteLdap=function(a){Swal.fire({title:"Are you sure?",text:"This will delete the LDAP config. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete "+escapeHtml(ldap_servers[a].name),confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise((function(e,l){api.LDAPId.delete(ldap_servers[a].id).success((function(a){e()})).error((function(a){l(a.responseJSON.message)}))}))}}).then((function(a){a.value&&Swal.fire("LDAP config Deleted!","This LDAP config has been deleted!","success"),$('button:contains("OK")').on("click",(function(){location.reload()}))}))};function editLdap(a){if($("#ldap_modalSubmit").unbind("click").click((function(){saveLdap(a)})),-1!=a){$("#ldapModalLabel").text("Edit LDAP config");let e=ldap_servers[a];$("#ldap_name").val(e.name),$("#ldap_protocol").val(e.protocol),$("#ldap_host").val(e.host),$("#ldap_username").val(e.username),$("#ldap_password").val(e.password),$("#ldap_base_dn").val(e.base_dn),$("#ldap_query").val(e.query),$("#ldap_attributes").val(e.attributes),$("#ldap_ignore_cert_errors").prop("checked",e.ignore_cert_errors)}else $("#ldapModalLabel").text("New LDAP config")}function loadLdaps(){$("#ldapTable").hide(),$("#ldap_emptyMessage").hide(),$("#ldap_loading").show(),api.LDAP.get().success((function(a){ldap_servers=a,$("#ldap_loading").hide(),ldap_servers.length>0?($("#ldapTable").show(),ldapTable=$("#ldapTable").DataTable({destroy:!0,columnDefs:[{orderable:!1,targets:"no-sort"}]}),ldapTable.clear(),ldapRows=[],$.each(ldap_servers,(function(a,e){ldapRows.push([escapeHtml(e.name),escapeHtml(e.host),moment(e.modified_date).format("MMMM Do YYYY, h:mm:ss a"),"<div class='pull-right'><span data-toggle='modal' data-backdrop='static' data-target='#ldap_modal'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Edit LDAP config' onclick='editLdap("+a+")'>                    <i class='fa fa-pencil'></i>                    </button></span>                    <button class='btn btn-danger' data-toggle='tooltip' data-placement='left' title='Delete LDAP config' onclick='deleteLdap("+a+")'>                    <i class='fa fa-trash-o'></i>                    </button></div>"])})),ldapTable.rows.add(ldapRows).draw(),$('[data-toggle="tooltip"]').tooltip()):$("#ldap_emptyMessage").show()})).error((function(){$("#ldap_loading").hide(),errorFlash("Error fetching LDAP configs")}))}$(document).ready((function(){$("#ldap_modal").on("hidden.bs.modal",(function(a){dismissLdap()})),loadLdaps()}));