$(document).ready(function(){function e(){$("#flashes").empty(),api.IMAP.get().success(function(e){$("#imapusername").val(e.username),$("#imaphost").val(e.host),$("#imapport").val(e.port),$("#imappassword").val(e.password),$("#use_tls").prop("checked",e.tls),$("#use_imap").prop("checked",e.enabled)}).error(function(){errorFlash("Error fetching IMAP settings")})}$("#apiResetForm").submit(function(e){return api.reset().success(function(e){user.api_key=e.data,successFlash(e.message),$("#api_key").val(user.api_key)}).error(function(e){errorFlash(e.message)}),!1}),$("#settingsForm").submit(function(e){return $.post("/settings",$(this).serialize()).done(function(e){successFlash(e.message)}).fail(function(e){errorFlash(e.responseJSON.message)}),!1}),$("#imapForm").submit(function(e){var t={};return t.host=$("#imaphost").val(),t.port=$("#imapport").val(),t.username=$("#imapusername").val(),t.password=$("#imappassword").val(),t.enabled=$("#use_imap").prop("checked"),t.tls=$("#use_tls").prop("checked"),""==t.port?(errorFlash("No IMAP Host specified"),document.body.scrollTop=0,document.documentElement.scrollTop=0):isNaN(t.port)||t.port<1||65535<t.port?(errorFlash("Invalid IMAP Port"),document.body.scrollTop=0,document.documentElement.scrollTop=0):query("/imap/","POST",t,!0).done(function(e){1==e.success?successFlashFade("Successfully updated IMAP settings.",2):errorFlash("Unable to update IMAP settings.")}).fail(function(e){errorFlash(e.responseJSON.message)}).always(function(e){document.body.scrollTop=0,document.documentElement.scrollTop=0}),!1}),$("#testimap").click(function(){var e=$("#testimap").html();$("#imaphost").attr("disabled",!0),$("#imapport").attr("disabled",!0),$("#imapusername").attr("disabled",!0),$("#imappassword").attr("disabled",!0),$("#use_imap").attr("disabled",!0),$("#use_tls").attr("disabled",!0),$("#testimap").attr("disabled",!0),$("#testimap").html("<i class='fa fa-circle-o-notch fa-spin'></i> Testing...");var t={};t.host=$("#imaphost").val(),t.port=$("#imapport").val(),t.username=$("#imapusername").val(),t.password=$("#imappassword").val(),t.tls=$("#use_tls").prop("checked"),query("/imap/test","POST",t,!0).done(function(e){1==e.success?swal({title:"Success",text:"Logged into <b>"+$("#imaphost").val()+"</b>",type:"success"}):swal({title:"Failed!",text:"Unable to login to <b>"+$("#imaphost").val()+"</b>.",type:"error",showCancelButton:!0,cancelButtonText:"Close",confirmButtonText:"More Info",confirmButtonColor:"#428bca",allowOutsideClick:!1,preConfirm:function(){swal({title:"Error:",text:e.message})}})}).fail(function(){swal({title:"Failed!",text:"An unecpected error occured.",type:"error"})}).always(function(){$("#imaphost").attr("disabled",!1),$("#imapport").attr("disabled",!1),$("#imapusername").attr("disabled",!1),$("#imappassword").attr("disabled",!1),$("#use_imap").attr("disabled",!1),$("#use_tls").attr("disabled",!1),$("#testimap").attr("disabled",!1),$("#testimap").html(e)})}),$("#reporttab").click(function(){e()});var t=localStorage.getItem("gophish.use_map");$("#use_map").prop("checked",JSON.parse(t)),$("#use_map").on("change",function(){localStorage.setItem("gophish.use_map",JSON.stringify(this.checked))}),e()});